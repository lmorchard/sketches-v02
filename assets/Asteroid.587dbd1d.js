var ne=Object.defineProperty;var te=(l,e,t)=>e in l?ne(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var P=(l,e,t)=>(te(l,typeof e!="symbol"?e+"":e,t),t);import{f as S,j as oe,T as n,P as v,V as B,G as D,o as T,B as G,k as se,S as ae,l as L,d as ie}from"./Replay.c9641c9b.js";import{c as m,V as w,b as re}from"./PositionIndex.ce0183fb.js";const N=4,W=S({radius:n.f32,groups:[n.ui8,N]}),z=S(),ce=S({maxSpeed:n.f32,acceleration:n.f32,braking:n.f32}),de=S({force:n.f32,x:n.f32,y:n.f32}),le=S({force:n.f32,x:n.f32,y:n.f32}),fe=S({force:n.f32,distance:n.f32,radius:n.f32,angle:n.f32}),H=S({force:n.f32,groups:[n.ui8,N],range:n.f32,viewAngle:n.f32}),pe=S({force:n.f32,originX:n.f32,originY:n.f32,marginX:n.f32,marginY:n.f32});class X extends G{}P(X,"components",{Position:v,Velocity:B,Steering:z,MaintainSpeed:ce,Seek:de,Flee:le,Wander:fe,AvoidObstacles:H,AvoidBorder:pe}),P(X,"componentProxyClasses",{Position:w,Velocity:w});const U=oe([z,v,B]),be=(l={})=>{const e=new X,t=new m(0,0),d=new m,i=new m,f=a=>{for(const r of U(a)){e.using(r,a);const{Velocity:o,Position:c,MaintainSpeed:g}=e;g.hasComponent()&&o.add(ee()),i.copy(t).add(s(),y(),q(),J(),Z());const h=o.length();o.add(i).truncate(h),c.r=Math.atan2(o.y,o.x)}return a},p=new m,s=()=>{if(!e.Seek.hasComponent())return;const{Seek:{force:a,x:r,y:o},Position:c}=e;return p.copy(d.set(r,o)).subtract(c).truncate(a)},u=new m,y=()=>{if(!e.Flee.hasComponent())return;const{Flee:{force:a,x:r,y:o},Position:c}=e;return u.copy(d.set(r,o)).subtract(c).truncate(a).multiplyScalar(-1)},x=new m,b=new m,q=()=>{if(!e.Wander.hasComponent())return;e.Wander.angle+=Math.PI*(Math.random()*.25-.125);const{Wander:{force:a,distance:r,radius:o,angle:c},Velocity:g}=e;return x.set(0,-1).scaleBy(o).rotate(c),b.clone(g).normalize().scaleBy(r).add(x).truncate(a)},O=new w(v),k=new D(W),R=new m,E=new m,J=()=>{if(!e.AvoidObstacles.hasComponent())return;const{AvoidObstacles:{force:a,radius:r},AvoidObstacles:o,Position:c,Velocity:g,world:h,eid:A}=e,M=Q(h,A,c,g,o,k,O);R.copy(t);for(const C of M){T(C,O,k);const V=c.distanceTo(O)-k.radius-r,I=V==0?1/Math.pow(V,2):1;E.copy(c).subtract(O).normalize().scaleBy(a).scaleBy(I),R.add(E)}return R.truncate(a),R},K=new m,Z=()=>{if(!e.AvoidBorder.hasComponent())return;const{Position:a,AvoidBorder:{originX:r=0,originY:o=0,marginX:c=200,marginY:g=200,force:h=7},world:{renderer:{width:A,height:M}},eid:C}=e,V=(A-c)/2,I=(M-g)/2,{x:F,y:_}=a;return F>r-V&&F<r+V&&_>o-I&&_<o+I?t:K.copy(d.set(r,o)).subtract(a).truncate(h)},$=new m,ee=()=>{if(!e.MaintainSpeed.hasComponent())return;const{MaintainSpeed:{maxSpeed:a,acceleration:r,braking:o},Velocity:c}=e;if(r===0&&o===0)return t;const g=c.lengthSquared(),h=a*a;if(g===h)return t;const A=g>h,M=Math.min(Math.abs(h-g),A?o:r),C=A?-M:M;return $.clone(c).normalize().multiplyScalar(C)};return f};function Q(l,e,t,d,i,f,p){const s=d.angle();return re.using(l).findNearestToEntity(e,i.range).filter(u=>{if(!se(l,W,u)||(T(u,p,f),i.groups.filter(b=>f.groups.includes(b)).length===0))return!1;const y=t.angleTo(p);return Math.abs(s-y)<i.viewAngle})}const we=(l={})=>{const e=new D(H),t=new w(v),d=new w(B),i=new w(v),f=new D(W),p=new w(B);return s=>{if(!s||!s.debug)return s;const u=s.debugGraphics;for(const y of U(s)){T(y,e,t,d);const x=Q(s,y,t,d,e,f,i);for(const b of x)T(b,i,f,p),u.lineStyle(2,16720639,.25),u.moveTo(t.x,t.y),u.lineTo(i.x,i.y)}return s}},ue=7,j=25,ye=30,ge=50,me=S({numRadii:n.ui8,maxRadius:n.f32,minRadius:n.f32,radii:[n.f32,j]});class Y extends G{static spawn(e,t={}){let{AsteroidLines:{numRadii:d=L(Math.random,ue,j),minRadius:i=ye,maxRadius:f=ge,radii:p=[]}={}}=t;for(let s=0;s<d;s++)p.push(L(Math.random,i,f));return super.spawn(e,{AsteroidLines:{numRadii:d,minRadius:i,maxRadius:f,radii:p},...t})}}P(Y,"components",{Position:v,Velocity:B,SpriteOptions:ae,AsteroidLines:me}),P(Y,"defaults",{SpriteOptions:{scaleX:1,scaleY:1,lineWidth:1,color:16777215}});class Ae extends ie{draw(e,t){const{g:d}=this;super.draw(e,t);const{numRadii:i,radii:f}=t.AsteroidLines,p=Math.PI*2/i;let s=0;const u=[];for(let y=0;y<i;y++){s+=p;const x=Math.cos(s),b=Math.sin(s);u.push(f[y]*x,f[y]*b)}d.moveTo(0,0),d.drawPolygon(...u)}}export{H as A,le as F,ce as M,W as O,z as S,fe as W,we as a,de as b,pe as c,Y as d,Ae as e,be as s};
