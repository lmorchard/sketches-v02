var X=Object.defineProperty;var N=(n,e,t)=>e in n?X(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e,t)=>(N(n,typeof e!="symbol"?e+"":e,t),t);import"./index.7a991a0b.js";import{f as S,j as Q,T as c,k as H,P as h,B as R,V as v,S as O,d as E,i as j,a as W,t as G,r as $,p as V,m as z,e as J,g as K,s as Z,c as ee,l as B,b as te}from"./Replay.c9641c9b.js";import{E as I,a as se,T as ne,e as oe,b as ae,s as ie,c as re}from"./Expiration.8f722eed.js";import{O as A,S as ce,M as le,s as ue,a as de}from"./Asteroid.587dbd1d.js";import{A as M,p as pe,a as he,b as me}from"./PositionIndex.ce0183fb.js";import{C as T,B as D,d as C,b as fe,c as ge,a as ye,e as xe}from"./Bouncer.0116962f.js";import"./easings.d07c69a5.js";const f=S({max:c.f32,initial:c.f32,current:c.f32}),P=Symbol("health"),_=Symbol("hurt"),k=Symbol("heal"),we={[_]:-1,[k]:1};class Se{using(e){return this.world=e,this}get _store(){return this.world[P]||(this.world[P]={pending:new Map}),this.world[P]}get pending(){return this._store.pending}clear(){return this.pending.clear(),this}queue(e,t,s){return this.pending.has(e)||this.pending.set(e,[]),this.pending.get(e).push([t,s]),this}hurt(e,t){return this.queue(e,_,t)}heal(e,t){return this.queue(e,k,t)}resolve(e){return(this.pending.get(e)||[]).reduce((s,[o,a])=>s+a*(we[o]||0),0)}}const m=new Se,q=Q([f]),Te=(n={})=>e=>{m.using(e);for(const t of q(e))f.current[t]+=m.resolve(t);return m.clear(),e},be=(n={})=>e=>{if(!e||!e.debug)return;m.using(e);const t=e.debugGraphics;t.lineStyle(10,65331,.25);for(const s of q(e)){if(!H(e,h,s))continue;const o=h.x[s],a=h.y[s],i=f.current[s],r=f.max[s];t.moveTo(o-20,a),t.lineTo(o-20+40*(i/r),a)}return e},Y=S({width:c.f32,height:c.f32});class y extends R{update(){this.Health.current<=0&&(this.spawnTombstone(),this.remove())}spawnTombstone(){const{x:e,y:t}=this.Position;return I.spawn(this.world).add({Expiration:se,Tombstone:ne}).set({Position:{x:e,y:t,r:0},Expiration:{timeToLive:.5},SpriteOptions:{scaleX:1,scaleY:1,lineWidth:2}})}}u(y,"components",{Brick:Y,Position:h,Velocity:v,SpriteOptions:O,Collidable:T,AreaCapsule:M,Obstacle:A,Bounce:D,Health:f}),u(y,"defaults",{Brick:{width:40,height:10},SpriteOptions:{scaleX:1,scaleY:1,lineWidth:2,color:16777215},Velocity:{x:0,y:0},Obstacle:{groups:[1],radius:40},Collidable:{group:1},AreaCapsule:{radius:10,length:40},Bounce:{mass:1e6,restitution:.9},Health:{max:100,current:100}});class Be extends E{draw(e,t){super.draw(e,t);const{g:s}=this,{Brick:{width:o,height:a}}=t;s.moveTo(0-a/4,0),s.lineTo(a/4,0),s.moveTo(0,0-o/4),s.lineTo(0,o/4),s.drawRoundedRect(0-a/2,0-o/2,a,o,8)}}const Pe=S({radius:c.f32});class l extends R{update(){C.using(this.world),m.using(this.world);const e=C.get(this.eid);if(e)for(const t of e)H(world,Y,t)&&m.hurt(t,25)}}u(l,"components",{Ball:Pe,Position:h,Velocity:v,SpriteOptions:O,Collidable:T,AreaCapsule:M,Steering:ce,Obstacle:A,MaintainSpeed:le,Bounce:D,Health:f}),u(l,"defaults",{Ball:{radius:10},SpriteOptions:{scaleX:1,scaleY:1,lineWidth:2,color:16777215},Velocity:{x:0,y:0},Obstacle:{groups:[1],radius:10},MaintainSpeed:{maxSpeed:300,acceleration:50,braking:50},Collidable:{group:1},AreaCapsule:{radius:10,length:2},Bounce:{mass:100,restitution:.9},Health:{max:1e3,current:1e3}});class Ce extends E{draw(e,t){super.draw(e,t);const{g:s}=this,{Ball:{radius:o}}=t;s.moveTo(0,0-o/4),s.lineTo(0,o/4),s.moveTo(0-o/4,0),s.lineTo(o/4,0),s.drawCircle(0,0,o)}}const Re=S({width:c.f32,height:c.f32});class d extends R{}u(d,"components",{Boundary:Re,Position:h,Velocity:v,SpriteOptions:O,Collidable:T,AreaCapsule:M,Obstacle:A,Bounce:D}),u(d,"defaults",{Boundary:{width:40,height:400},SpriteOptions:{scaleX:1,scaleY:1,lineWidth:2,color:16777215},Velocity:{x:0,y:0},Obstacle:{groups:[1],radius:40},Collidable:{group:1},AreaCapsule:{radius:40,length:400},Bounce:{mass:1e6,restitution:.9,immobile:1}});class ve extends E{draw(e,t){super.draw(e,t);const{g:s}=this,{Boundary:{width:o,height:a}}=t;s.moveTo(0,0-a/4),s.lineTo(0,a/4),s.moveTo(0-o/4,0),s.lineTo(o/4,0),s.drawRoundedRect(0-o/2,0-a/2,o,a,8)}}async function Oe(){const n=j(),e=W();n.debug=!0;const t=new G.exports.Pane,s=t.addFolder({title:document.title,expanded:!0});n.addToPane(s);const o={historyPeriod:0,maxHistory:60*10,updateDelta:1e3/60};$(s,n,o),Me(n),Ve(n),n.run(V(Te(),ie({entityQuery:l.query,spawnEntity:De,maxEntities:10,maxPerFrame:1,spawnDelay:0}),J([[y],[l],[d]]),Ee(),ae(),pe(),z(),oe(),ge(),ue(),fe({separationFactor:.2}),te(o),Ae({pane:t})),V(ee(),Z([[y,Be],[l,Ce],[d,ve],[I,re]]),K(),be(),he(),ye(),de(),xe()),e),Object.assign(window,{world:n,positionIndexService:me,collisionService:C,Collidable:T}),console.log("READY.")}const Ee=(n={})=>{const e=new l;return t=>{const{marginX:s=100,marginY:o=100}=n,{renderer:{width:a,height:i}}=t;for(const r of l.query(t)){e.using(r,t);const{x,y:w}=e.Position,g=(a+s)/2,p=(i+o)/2;(x<-g||x>g||w<-p||w>p)&&e.remove()}return t}},Ae=({pane:n})=>e=>(n.refresh(),e);function Me(n){d.spawn(n,{Position:{x:-600,y:0},Boundary:{width:40,height:800},AreaCapsule:{radius:40,length:800}}),d.spawn(n,{Position:{x:600,y:0},Boundary:{width:40,height:800},AreaCapsule:{radius:40,length:800}}),d.spawn(n,{Position:{x:0,y:-450,r:Math.PI/2},Boundary:{width:40,height:1250},AreaCapsule:{radius:40,length:1250}})}function De(n,{ballSize:e=10,startX:t=-400,maxX:s=400,startY:o=500}={}){const a=B(Math.random,t,s),i=o;l.spawn(n,{Position:{x:a,y:i},Velocity:{x:-10+Math.random()*20,y:B(Math.random,-50,-200)},Ball:{radius:e},MaintainSpeed:{maxSpeed:B(Math.random,100,500)},AreaCapsule:{length:2,radius:e}})}function Ve(n,e=-500,t=700,s=-350,o=0,a=75,i=25,r=50){const x=Math.floor((t-e)/(a+r)),w=Math.floor((o-s)/(i+r)),g=[];for(let p=0;p<x;p++)for(let b=0;b<w;b++){const F=e+p*(a+r),L=s+b*(i+r),U=y.spawn(n,{Brick:{width:a,height:i},Position:{x:F,y:L,r:Math.PI/2},Obstacle:{radius:i},AreaCapsule:{length:a,radius:i/2},Health:{max:100,current:100}});g.push(U)}return g}Oe().catch(console.error);
