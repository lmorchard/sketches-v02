import"./index.7a991a0b.js";import{f as T,j as B,T as P,V as l,G as m,o as S,P as h,h as L,i as Q,a as V,t as q,r as A,p as R,b as H,m as j,k as N,g as O,s as U,c as W}from"./Replay.c9641c9b.js";import{B as k,h as z,a as _}from"./Boid.f2683d21.js";import{b as $,p as J}from"./PositionIndex.ce0183fb.js";import{e as K,b as Z,s as tt,a as b,T as X,E as Y,c as et}from"./Expiration.8f722eed.js";import"./easings.d07c69a5.js";const I=T({acceleration:P.f32,targetSpeed:P.f32}),nt=B([l,I]),ot=o=>{const n=new m(l),e=new m(I);return t=>{for(const c of nt(t)){S(c,e,n);const{acceleration:a,targetSpeed:y}=e,{x:u,y:x}=n;if(Math.pow(u,2)+Math.pow(x,2)>=Math.pow(y,2))continue;const f=Math.atan2(n.y,n.x);n.x+=a*Math.cos(f),n.y+=a*Math.sin(f)}return t}},w=T({flockGroup:P.ui32}),at=B([h,l,w]),st=(o={})=>{const n=new m(w),e=new m(h),t=new m(l),c=new m(w),a=new m(h),y=new m(l),u=r=>{const{visualRange:d,visualEntityLimit:s,centeringFactor:i,avoidFactor:p,avoidMinDistance:g,matchingFactor:F}=o;for(const D of at(r)){S(D,n,e,t);const{flockGroup:G}=n,E=x(r,D,d,G,s);E.length!=0&&(M(E,i),f(E,p,g),v(E,F),e.r=Math.atan2(t.y,t.x))}return r},x=(r,d,s,i,p=7)=>$.using(r).findNearestToEntity(d,s,p).filter(g=>i===w.flockGroup[g]),M=(r,d)=>{let s=0,i=0;for(const p of r)S(p,c,a,y),s+=a.x,i+=a.y;s=s/r.length,i=i/r.length,t.x+=(s-e.x)*d,t.y+=(i-e.y)*d},f=(r,d,s)=>{const i=Math.pow(s,2);let p=0,g=0;for(const F of r)S(F,c,a,y),L(e.x,e.y,a.x,a.y)<i&&(p+=e.x-a.x,g+=e.y-a.y);t.x+=p*d,t.y+=g*d},v=(r,d)=>{let s=0,i=0;for(const p of r)S(p,c,a,y),s+=y.x,i+=y.y;s=s/r.length,i=i/r.length,t.x+=(s-t.x)*d,t.y+=(i-t.y)*d};return u},C=T({}),it=B([C,h,l]),rt=(o={})=>{const n=new m(h),e=new m(l);return t=>{const{originX:c=0,originY:a=0,marginX:y=200,marginY:u=200,originTurnFactor:x=7}=o,{renderer:{width:M,height:f}}=t,v=(M-y)/2,r=(f-u)/2;for(const d of it(t)){S(d,n,e);const{x:s,y:i}=n;if(s>c-v&&s<c+v&&i>a-r&&i<a+r)continue;const p=Math.atan2(a-i,c-s);e.x+=x*Math.cos(p),e.y+=x*Math.sin(p)}return t}},ct=200;async function dt(){const o=Q(),n=V(),e=new q.exports.Pane,t=e.addFolder({title:document.title,expanded:!0});o.addToPane(t);const c={historyPeriod:0,maxHistory:60*10,updateDelta:1e3/60};A(t,o,c);const a={entityQuery:k.query,spawnEntity:mt,maxEntities:ct,maxPerFrame:20,spawnDelay:.25},y={visualRange:30,visualEntityLimit:7,centeringFactor:.005,avoidFactor:.05,avoidMinDistance:20,matchingFactor:.05};pt(t,{spawnerOptions:a,flockingBoidsOptions:y}),o.run(R(tt(a),j(),J(),st(y),Z(),ot(),rt(),K(u=>{N(o,X,u)||lt(o,u)}),H(c),yt(e,t)),R(W(),U([[k,_],[Y,et]]),O()),n),window.world=o,console.log("READY.")}function pt(o,{spawnerOptions:n,flockingBoidsOptions:e}){const t=o.addFolder({title:"options",expanded:!0});t.addInput(e,"visualRange",{min:5,max:200,step:1}),t.addInput(e,"visualEntityLimit",{min:3,max:12,step:1}),t.addInput(e,"centeringFactor",{min:.001,max:1,step:.001}),t.addInput(e,"avoidFactor",{min:.01,max:1,step:.01}),t.addInput(e,"avoidMinDistance",{min:5,max:100,step:1}),t.addInput(e,"matchingFactor",{min:.01,max:1,step:.01}),t.addInput(n,"maxEntities",{min:10,max:1e3})}const yt=(o,n)=>{const e=n.addFolder({title:"stats",expanded:!0}),t={boidsCount:0};return Object.keys(t).forEach(c=>e.addMonitor(t,c)),c=>(t.boidsCount=k.query(c).length,o.refresh(),c)},mt=o=>{const n=Math.PI*2*Math.random(),e=1e3*Math.cos(n),t=1e3*Math.sin(n);return k.spawn(o).add({Expiration:b,SeekSpeed:I,AvoidScreenBounds:C,FlockingBoid:w}).set({Position:{x:e,y:t,r:0},Velocity:{x:-300+Math.random()*600,y:-300+Math.random()*600,r:0},SpriteOptions:{scaleX:.125,scaleY:.125,lineWidth:10,color:z(Math.random(),1,.5),faceHeading:1},Expiration:{timeToLive:Math.random()*30},SeekSpeed:{acceleration:1,targetSpeed:200},FlockingBoid:{flockGroup:1}})},lt=(o,n)=>Y.spawn(o).add({Expiration:b,Tombstone:X}).set({Position:{x:h.x[n],y:h.y[n],r:0},Velocity:{x:l.x[n]/3,y:l.y[n]/3,r:0},SpriteOptions:{scaleX:.5,scaleY:.5,lineWidth:2},Expiration:{timeToLive:1}});dt().catch(console.error);
